<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WIDE - Python IDE</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">

<style>
/* ---------------- BODY ---------------- */
body {
  margin:0;
  padding:20px;
  font-family: monospace;
  background-color:#1e1e1e;
  color:white;
  text-align:center;
}

/* ---------------- HEADER ---------------- */
h1 {
  font-size:48px;
  margin-bottom:20px;
  letter-spacing:2px;
}

/* ---------------- TOOLBAR ---------------- */
#toolbar {
  margin-bottom:10px;
}
#toolbar button {
  padding:12px 24px;
  font-size:18px;
  background-color:#6272a4;
  color:white;
  border:1px solid #fff;
  border-radius:5px;
  cursor:pointer;
  margin:5px;
}
#toolbar select {
  font-size:16px;
  margin-left:5px;
}

/* ---------------- IDE LAYOUT ---------------- */
#ide-container {
  display:flex;
  width:90%;
  margin:0 auto;
  height:500px;
  gap:10px;
}

#editor-container, #output-container {
  flex:1;
  display:flex;
  flex-direction:column;
  border:2px solid white;
  box-sizing:border-box;
  height:100%;
}

/* CodeMirror fills container */
.CodeMirror { flex:1; height:100%; text-align:left; }

/* Output */
#output {
  flex:1;
  background-color:#111;
  color:#00ff00;
  padding:10px;
  white-space:pre-wrap;
  overflow-y:auto;
  text-align:left;
}

/* Input box */
#inputBox {
  margin-top:5px;
  width:100%;
  padding:10px;
  font-family:monospace;
  font-size:16px;
}

/* Light mode */
body.light {
  background-color:#f5f5f5;
  color:#111;
}
body.light #editor-container, body.light #output-container { border-color:#111; }
body.light #output { background-color:#fff; color:#000; }
body.light #toolbar button { background-color:#ddd; color:#000; border-color:#000; }
</style>

<!-- ---------------- SCRIPTS ---------------- -->
<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>
</head>

<body>

<h1>WIDE</h1>

<!-- SIGN UP / LOGIN -->
<div id="authContainer">
  <button id="signUpBtn">Sign Up</button>
  <button id="loginBtn">Log In</button>
  <button id="guestBtn">Continue as Guest</button>
</div>

<!-- TOOLBAR -->
<div id="toolbar" style="display:none;">
  <button id="runBtn">Run Python</button>
  <button id="downloadBtn">Download .py</button>
  <button id="shareBtn">Share this code</button>
  <button id="themeBtn">Light Mode</button>
  <button id="fileBtn">Save File</button>
  <button id="deleteFileBtn">Delete File</button>
  <button id="renameFileBtn">Rename File</button>
  <select id="fileList">
    <option value="">Select file...</option>
  </select>
</div>

<!-- IDE -->
<div id="ide-container" style="display:none;">
  <div id="editor-container">
    <textarea id="editor"></textarea>
  </div>
  <div id="output-container">
    <h2>Output</h2>
    <pre id="output"></pre>
    <input id="inputBox" placeholder="Type input and press Enter">
  </div>
</div>

<script>
/* ---------------- AUTH ---------------- */
let users = JSON.parse(localStorage.getItem("wide_users") || "{}");
let currentUser = null;

const authContainer = document.getElementById("authContainer");
const toolbar = document.getElementById("toolbar");
const ideContainer = document.getElementById("ide-container");

function showIDE() {
  authContainer.style.display = "none";
  toolbar.style.display = "block";
  ideContainer.style.display = "flex";
}

document.getElementById("signUpBtn").onclick = () => {
  const username = prompt("Choose a username:");
  if(!username) return alert("Username required!");
  if(users[username]) return alert("Username taken!");
  const password = prompt("Choose a password:");
  if(!password) return alert("Password required!");
  users[username] = password;
  localStorage.setItem("wide_users", JSON.stringify(users));
  alert("Sign up complete! Please log in now.");
};

document.getElementById("loginBtn").onclick = () => {
  const username = prompt("Username:");
  const password = prompt("Password:");
  if(users[username] && users[username] === password){
    currentUser = username;
    alert("Welcome to WIDE, " + username + "!");
    showIDE();
  } else {
    alert("Incorrect username or password.");
  }
};

document.getElementById("guestBtn").onclick = () => {
  currentUser = "Guest";
  showIDE();
};

/* ---------------- CODE EDITOR ---------------- */
const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
  mode:"python",
  theme:"dracula",
  lineNumbers:true,
  indentUnit:4,
  tabSize:4
});

const output = document.getElementById("output");
const inputBox = document.getElementById("inputBox");
let inputResolve = null;

function outf(text){output.textContent += text;}
function builtinInput(promptText){output.textContent+=promptText+"\n"; inputBox.focus(); return new Promise(resolve=>inputResolve=resolve);}
inputBox.addEventListener("keydown", e => { if(e.key==="Enter" && inputResolve){ const val=inputBox.value; output.textContent+=val+"\n"; inputBox.value=""; inputResolve(val); inputResolve=null; }});
function builtinRead(x){ if(!Sk.builtinFiles||!Sk.builtinFiles["files"][x]) throw "File not found: '"+x+"'"; return Sk.builtinFiles["files"][x]; }

function runCode(){ 
  output.textContent="";
  Sk.configure({output:outf, read:builtinRead, inputfun:builtinInput, inputfunTakesPrompt:true});
  Sk.misceval.asyncToPromise(()=>Sk.importMainWithBody("<stdin>", false, editor.getValue(), true))
  .catch(err=>output.textContent+=err.toString());
}
document.getElementById("runBtn").onclick = runCode;

// Auto-save
editor.on("change", ()=>localStorage.setItem("willIDE_code",editor.getValue()));

// Load saved code and theme
window.onload = ()=>{
  const saved=localStorage.getItem("willIDE_code");
  if(saved) editor.setValue(saved);
  const theme = localStorage.getItem("wide_theme") || "dark";
  setTheme(theme);
  editor.refresh();
};

/* ---------------- DOWNLOAD ---------------- */
document.getElementById("downloadBtn").onclick = ()=>{
  const blob = new Blob([editor.getValue()], {type:"text/plain"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download="code.py";
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
};

/* ---------------- SHARE ---------------- */
document.getElementById("shareBtn").onclick = ()=>{
  const url = `${location.origin}${location.pathname}?code=${encodeURIComponent(editor.getValue())}`;
  navigator.clipboard.writeText(url);
  alert("Share URL copied!");
};

/* ---------------- THEME ---------------- */
const themeBtn = document.getElementById("themeBtn");
function setTheme(mode){
  if(mode==="light"){ document.body.classList.add("light"); editor.setOption("theme","default"); themeBtn.textContent="Dark Mode"; }
  else{ document.body.classList.remove("light"); editor.setOption("theme","dracula"); themeBtn.textContent="Light Mode"; }
  localStorage.setItem("wide_theme", mode);
}
themeBtn.onclick = ()=>setTheme(document.body.classList.contains("light")?"dark":"light");

/* ---------------- FILE MANAGEMENT ---------------- */
let files = {}; // in-memory storage

const fileBtn = document.getElementById("fileBtn");
const deleteFileBtn = document.getElementById("deleteFileBtn");
const renameFileBtn = document.getElementById("renameFileBtn");
const fileList = document.getElementById("fileList");

function updateFileList() {
  fileList.innerHTML = '<option value="">Select file...</option>';
  for (const fname in files) {
    const option = document.createElement("option");
    option.value = fname;
    option.textContent = fname;
    fileList.appendChild(option);
  }
}

// Save file
fileBtn.onclick = () => {
  if(currentUser === "Guest") return alert("Files are only for signed-in users.");
  const fname = prompt("Enter file name:");
  if(!fname) return;
  files[fname] = editor.getValue();
  updateFileList();
  alert(`Saved as ${fname}`);
};

// Delete file
deleteFileBtn.onclick = () => {
  if(currentUser === "Guest") return alert("Files are only for signed-in users.");
  const fname = fileList.value;
  if(!fname) return alert("Select a file to delete");
  if(!confirm("Delete " + fname + "?")) return;
  delete files[fname];
  updateFileList();
  editor.setValue("");
  alert(fname + " deleted");
};

// Rename file
renameFileBtn.onclick = () => {
  if(currentUser === "Guest") return alert("Files are only for signed-in users.");
  const fname = fileList.value;
  if(!fname) return alert("Select a file to rename");
  const newName = prompt("Enter new name for " + fname + ":");
  if(!newName) return;
  if(files[newName] !== undefined) return alert("A file with that name exists!");
  files[newName] = files[fname];
  delete files[fname];
  updateFileList();
  fileList.value = newName;
  alert(fname + " renamed to " + newName);
};

// Load file into editor
fileList.onchange = () => {
  const fname = fileList.value;
  if(fname && files[fname] !== undefined) editor.setValue(files[fname]);
};
</script>

</body>
</html>













