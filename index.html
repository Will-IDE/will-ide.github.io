<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WIDE - Browser Python IDE</title>

<!-- CodeMirror -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>

<!-- Skulpt -->
<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>

<style>
body{
  margin:0;
  font-family:monospace;
  background:#111;
  color:#fff;
}

#topbar{
  background:#000;
  padding:14px;
  font-size:22px;
  text-align:center;
  border-bottom:2px solid #00bcd4;
}

#toolbar{
  text-align:center;
  padding:10px;
}

#toolbar button{
  padding:8px 14px;
  margin:5px;
  background:#000;
  color:#fff;
  border:1px solid #333;
  border-radius:6px;
  cursor:pointer;
}

#toolbar button:hover{
  border-color:#00bcd4;
  color:#00bcd4;
}

#ide-container{
  width:95%;
  margin:20px auto;
  display:flex;
  gap:20px;
}

.editor-box, .output-box{
  flex:1;
  background:#000;
  border-radius:18px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  height:500px;
}

.CodeMirror{
  flex:1;
  height:100%;
  font-size:14px;
}

#output{
  flex:1;
  padding:10px;
  overflow-y:auto;
  color:#00ff88;
}

#welcomeScreen{
  position:fixed;
  inset:0;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:50;
}

#welcomeBox{
  background:#000;
  padding:40px;
  border-radius:20px;
  text-align:center;
  width:350px;
}

#welcomeBox button{
  width:100%;
  padding:12px;
  margin:10px 0;
  background:#111;
  border:1px solid #333;
  color:#fff;
  border-radius:10px;
  cursor:pointer;
}

#welcomeBox button:hover{
  border-color:#00bcd4;
}

#authPanel{
  position:fixed;
  inset:0;
  background:#111;
  display:none;
  justify-content:center;
  align-items:center;
  z-index:40;
}

#authBox{
  background:#000;
  padding:30px;
  border-radius:20px;
  text-align:center;
  width:320px;
}

#authBox input{
  width:90%;
  padding:10px;
  margin:8px 0;
  background:#111;
  border:1px solid #333;
  color:#fff;
}
</style>
</head>
<body>

<!-- Welcome -->
<div id="welcomeScreen">
  <div id="welcomeBox">
    <h1>Welcome to WIDE</h1>
    <button onclick="openAuth('signup')">Sign Up</button>
    <button onclick="openAuth('login')">Log In</button>
    <button onclick="enterGuest()">Use as Guest</button>
  </div>
</div>

<!-- Auth -->
<div id="authPanel">
  <div id="authBox">
    <h2 id="authTitle">Login</h2>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="handleAuth()">Continue</button>
  </div>
</div>

<div id="topbar">WIDE - Browser Python IDE</div>

<div id="toolbar">
  <button onclick="runCode()">Run</button>
  <button id="filesBtn" style="display:none;" onclick="showFiles()">Files</button>
  <button id="copyBtn" style="display:none;" onclick="copyCode()">Copy Code</button>
  <button id="logoutBtn" style="display:none;" onclick="logout()">Logout</button>
</div>

<div id="ide-container">
  <div class="editor-box">
    <textarea id="code">print("Hello, WIDE!")</textarea>
  </div>
  <div class="output-box">
    <div id="output"></div>
  </div>
</div>

<script>
let editor = CodeMirror.fromTextArea(document.getElementById("code"),{
  mode:"python",
  theme:"dracula",
  lineNumbers:true
});

let currentUser = null;
let authMode = "login";

/* Welcome */
function openAuth(mode){
  authMode = mode;
  document.getElementById("authTitle").innerText = 
      mode === "signup" ? "Sign Up" : "Log In";
  document.getElementById("welcomeScreen").style.display="none";
  document.getElementById("authPanel").style.display="flex";
}

function enterGuest(){
  currentUser = "guest";
  document.getElementById("welcomeScreen").style.display="none";
}

/* Auth */
function handleAuth(){
  let user = username.value.trim();
  let pass = password.value.trim();
  if(!user || !pass) return alert("Fill all fields");

  if(authMode==="signup"){
    if(localStorage.getItem("user_"+user)){
      alert("User already exists. Please log in.");
      return;
    }
    localStorage.setItem("user_"+user, pass);
    alert("Signup successful! Please log in.");
    openAuth("login");
    return;
  }

  if(authMode==="login"){
    let stored = localStorage.getItem("user_"+user);
    if(!stored){
      alert("Account not found. Please sign up first.");
      openAuth("signup");
      return;
    }
    if(stored !== pass){
      alert("Wrong password.");
      return;
    }

    currentUser = user;
    document.getElementById("authPanel").style.display="none";
    document.getElementById("filesBtn").style.display="inline-block";
    document.getElementById("copyBtn").style.display="inline-block";
    document.getElementById("logoutBtn").style.display="inline-block";
  }
}

/* Logout */
function logout(){
  currentUser = null;
  location.reload();
}

/* Copy Code */
function copyCode(){
  navigator.clipboard.writeText(editor.getValue());
  alert("Code copied!");
}

/* Files */
function showFiles(){
  if(currentUser==="guest"){
    alert("Guests cannot save files.");
    return;
  }

  let files = [];
  for(let i=0;i<localStorage.length;i++){
    let key = localStorage.key(i);
    if(key.startsWith("file_"+currentUser+"_")){
      files.push(key.replace("file_"+currentUser+"_",""));
    }
  }

  let choice = prompt("Your files:\n"+files.join("\n")+"\n\nType file name to open or new name to save:");
  if(!choice) return;

  let existing = localStorage.getItem("file_"+currentUser+"_"+choice);
  if(existing){
    editor.setValue(existing);
  }else{
    localStorage.setItem("file_"+currentUser+"_"+choice, editor.getValue());
    alert("Saved as new file!");
  }
}

/* Run Python */
function runCode(){
  document.getElementById("output").innerHTML="";
  Sk.configure({
    output:function(text){
      document.getElementById("output").innerHTML+=text;
    },
    read:function(x){
      if(Sk.builtinFiles===undefined || 
         Sk.builtinFiles["files"][x]===undefined)
        throw "File not found: '"+x+"'";
      return Sk.builtinFiles["files"][x];
    }
  });
  Sk.misceval.asyncToPromise(function(){
    return Sk.importMainWithBody("<stdin>", false, editor.getValue(), true);
  });
}
</script>

</body>
</html>



