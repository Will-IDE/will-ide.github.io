<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WIDE - Python IDE</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">

<style>
body {
  margin:0;
  padding:20px;
  font-family: monospace;
  background-color:#1e1e1e;
  color:white;
  text-align:center;
}

h1 {
  font-size:48px;
  margin-bottom:20px;
  letter-spacing:2px;
}

#toolbar {
  margin-bottom:10px;
}

#toolbar button, #toolbar select {
  padding:10px 18px;
  font-size:16px;
  background-color:#6272a4;
  color:white;
  border:1px solid #fff;
  border-radius:5px;
  cursor:pointer;
  margin:5px;
}

#ide-container {
  display:flex;
  width:90%;
  margin:0 auto;
  height:500px;
  gap:10px;
}

#editor-container, #output-container {
  flex:1;
  display:flex;
  flex-direction:column;
  border:2px solid white;
  box-sizing:border-box;
}

.CodeMirror {
  flex:1;
  height:100%;
  text-align:left;
}

#output {
  flex:1;
  background-color:#111;
  color:#00ff00;
  padding:10px;
  white-space:pre-wrap;
  overflow-y:auto;
  text-align:left;
}

#inputBox {
  width:100%;
  padding:10px;
  font-family:monospace;
  font-size:16px;
}

/* Light mode */
body.light {
  background-color:#f5f5f5;
  color:#111;
}
body.light #editor-container,
body.light #output-container {
  border-color:#111;
}
body.light #output {
  background-color:#fff;
  color:#000;
}
body.light #toolbar button,
body.light #toolbar select {
  background-color:#ddd;
  color:#000;
  border-color:#000;
}

/* ===== Auth Panel ===== */
#authPanel {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

#authBox {
  background:#222;
  padding:30px;
  border:2px solid white;
  border-radius:10px;
  width:280px;
}

#authBox input {
  display:block;
  margin:10px auto;
  padding:10px;
  font-size:16px;
  width:240px;
}

#authBox button {
  margin:8px;
  padding:10px 15px;
  font-size:16px;
}

#loginLink {
  cursor:pointer;
  text-decoration:underline;
  font-size:14px;
  margin-top:5px;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>
</head>

<body>

<h1>WIDE</h1>

<!-- ===== AUTH PANEL ===== -->
<div id="authPanel">
  <div id="authBox">
    <h2 id="authTitle">Welcome to WIDE</h2>

    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">

    <button id="signupBtn" style="font-size:18px;">Sign Up</button>

    <p id="loginLink">Already have an account? Log in</p>

    <button id="loginBtn" style="display:none;">Log In</button>

    <button id="guestBtn">Use Without Account</button>

    <p id="authMsg"></p>
  </div>
</div>

<!-- ===== TOOLBAR ===== -->
<div id="toolbar">
  <button id="runBtn">Run Python</button>
  <button id="downloadBtn">Download .py</button>
  <button id="shareBtn">Share</button>
  <button id="themeBtn">Light Mode</button>
  <button id="fileBtn">Files</button>
  <select id="fileList">
    <option value="">Select file...</option>
  </select>
</div>

<!-- ===== IDE ===== -->
<div id="ide-container">
  <div id="editor-container">
    <textarea id="editor"></textarea>
  </div>
  <div id="output-container">
    <h2>Output</h2>
    <pre id="output"></pre>
    <input id="inputBox" placeholder="Type input and press Enter">
  </div>
</div>

<script>
// ===== CodeMirror =====
const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
  mode:"python",
  theme:"dracula",
  lineNumbers:true,
  indentUnit:4,
  tabSize:4
});

const output = document.getElementById("output");
const inputBox = document.getElementById("inputBox");
let inputResolve = null;

function outf(text){ output.textContent += text; }

function builtinInput(promptText){
  output.textContent += promptText + "\n";
  inputBox.focus();
  return new Promise(resolve => inputResolve = resolve);
}

inputBox.addEventListener("keydown", e=>{
  if(e.key==="Enter" && inputResolve){
    const val = inputBox.value;
    output.textContent += val + "\n";
    inputBox.value="";
    inputResolve(val);
    inputResolve=null;
  }
});

function builtinRead(x){
  if(!Sk.builtinFiles || !Sk.builtinFiles["files"][x])
    throw "File not found: '"+x+"'";
  return Sk.builtinFiles["files"][x];
}

function runCode(){
  output.textContent="";
  Sk.configure({
    output:outf,
    read:builtinRead,
    inputfun:builtinInput,
    inputfunTakesPrompt:true
  });
  Sk.misceval.asyncToPromise(
    ()=>Sk.importMainWithBody("<stdin>", false, editor.getValue(), true)
  ).catch(err=>output.textContent += err.toString());
}
document.getElementById("runBtn").onclick = runCode;

// ===== Theme =====
const themeBtn = document.getElementById("themeBtn");
function setTheme(mode){
  if(mode==="light"){
    document.body.classList.add("light");
    editor.setOption("theme","default");
    themeBtn.textContent="Dark Mode";
  } else {
    document.body.classList.remove("light");
    editor.setOption("theme","dracula");
    themeBtn.textContent="Light Mode";
  }
  localStorage.setItem("wide_theme",mode);
}
themeBtn.onclick = ()=>setTheme(
  document.body.classList.contains("light") ? "dark" : "light"
);

// ===== Download =====
document.getElementById("downloadBtn").onclick = ()=>{
  const blob = new Blob([editor.getValue()],{type:"text/plain"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download="code.py";
  a.click();
};

// ===== Share =====
document.getElementById("shareBtn").onclick = ()=>{
  const url = location.origin + location.pathname + "?code=" + encodeURIComponent(editor.getValue());
  navigator.clipboard.writeText(url);
  alert("Share link copied!");
};

// ===== AUTH SYSTEM =====
let currentUser = null;
const authPanel = document.getElementById("authPanel");
const authMsg = document.getElementById("authMsg");
const authTitle = document.getElementById("authTitle");

function loadUsers(){
  return JSON.parse(localStorage.getItem("wide_users") || "{}");
}
function saveUsers(users){
  localStorage.setItem("wide_users", JSON.stringify(users));
}

// Toggle login button
document.getElementById("loginLink").onclick = ()=>{
  document.getElementById("loginBtn").style.display="inline-block";
};

// SIGN UP
document.getElementById("signupBtn").onclick = ()=>{
  authTitle.textContent = "Signing up...";

  const u = username.value.trim();
  const p = password.value;
  const users = loadUsers();

  if(users[u]){
    authMsg.textContent="User already exists";
    authTitle.textContent="Welcome to WIDE";
    return;
  }

  users[u] = {password:p, files:{}};
  saveUsers(users);
  authMsg.textContent="Account created! Now log in.";
  authTitle.textContent="Welcome to WIDE";
};

// LOG IN
document.getElementById("loginBtn").onclick = ()=>{
  authTitle.textContent = "Logging in...";

  const u = username.value.trim();
  const p = password.value;
  const users = loadUsers();

  if(users[u] && users[u].password === p){
    currentUser = u;
    authTitle.textContent="Welcome to WIDE";
    authPanel.style.display="none";
    initUserFiles();
  } else {
    authMsg.textContent="Wrong username or password";
    authTitle.textContent="Welcome to WIDE";
  }
};

// GUEST
document.getElementById("guestBtn").onclick = ()=>{
  authPanel.style.display="none";
  fileBtn.style.display="none";
  fileList.style.display="none";
};

// ===== FILE SYSTEM =====
let files = {};
const fileBtn = document.getElementById("fileBtn");
const fileList = document.getElementById("fileList");

function initUserFiles(){
  const users = loadUsers();
  if(users[currentUser]){
    files = users[currentUser].files || {};
    updateFileList();
  }
}

function saveUserFiles(){
  const users = loadUsers();
  users[currentUser].files = files;
  saveUsers(users);
}

function updateFileList(){
  fileList.innerHTML = '<option value="">Select file...</option>';
  for(const fname in files){
    const opt = document.createElement("option");
    opt.value=fname;
    opt.textContent=fname;
    fileList.appendChild(opt);
  }
}

fileBtn.onclick = ()=>{
  const fname = prompt("File name?");
  if(!fname) return;
  files[fname] = editor.getValue();
  saveUserFiles();
  updateFileList();
};

fileList.onchange = ()=>{
  const fname = fileList.value;
  if(fname && files[fname]) editor.setValue(files[fname]);
};

// ===== Load theme =====
window.onload = ()=>{
  const theme = localStorage.getItem("wide_theme") || "dark";
  setTheme(theme);
  editor.refresh();
};
</script>

</body>
</html>
















