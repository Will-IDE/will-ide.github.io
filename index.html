<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WIDE - Python IDE in Browser</title>

<!-- CodeMirror CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">

<style>
  body {
    font-family: monospace;
    background-color: #1e1e1e;
    color: white;
    margin: 0;
    padding: 20px;
    text-align: center;
  }

  /* Big title at the top */
  h1 {
    font-size: 48px;
    margin-bottom: 20px;
    letter-spacing: 2px;
  }

  /* Buttons toolbar */
  #toolbar {
    margin-bottom: 10px;
  }

  #toolbar button {
    padding: 12px 24px;
    font-size: 18px;
    background-color: #6272a4;
    color: white;
    border: 1px solid #fff;
    border-radius: 5px;
    cursor: pointer;
    margin: 5px;
  }

  /* IDE container: editor + output */
  #ide-container {
    display: flex;
    gap: 10px;
    justify-content: center;
    align-items: stretch; /* equal height */
    flex-wrap: wrap;
    margin-top: 10px;
  }

  #editor-container, #output-container {
    flex: 1;
    min-width: 300px;
    display: flex;
    flex-direction: column;
    border: 2px solid white; /* white border around boxes */
    padding: 5px;
    box-sizing: border-box;
  }

  .CodeMirror, #output {
    flex: 1; /* fill container height */
  }

  #output {
    background-color: #111;
    color: #00ff00;
    padding: 10px;
    white-space: pre-wrap;
    overflow-y: auto;
  }

  #inputBox {
    width: 100%;
    padding: 6px;
    font-size: 16px;
    font-family: monospace;
    margin-top: 5px;
    display: none; /* shown when input() is called */
  }
</style>

<!-- Skulpt -->
<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>

<!-- CodeMirror JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>

</head>
<body>

<!-- Big title -->
<h1>WIDE</h1>

<!-- Toolbar buttons -->
<div id="toolbar">
  <button id="runBtn">Run Python</button>
  <button id="downloadBtn">Download .py</button>
  <button id="shareBtn">Share this code</button>
</div>

<!-- IDE container -->
<div id="ide-container">
  <div id="editor-container">
    <textarea id="editor"></textarea>
  </div>
  <div id="output-container">
    <h2>Output:</h2>
    <pre id="output"></pre>
    <input id="inputBox" placeholder="Type input and press Enter">
  </div>
</div>

<script>
  const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
    mode: "python",
    theme: "dracula",
    lineNumbers: true,
    indentUnit: 4,
    tabSize: 4
  });

  const output = document.getElementById("output");
  const inputBox = document.getElementById("inputBox");
  let inputResolve = null;

  // Skulpt output
  function outf(text){ output.textContent += text; }

  // Skulpt input
  function builtinInput(promptText){
    output.textContent += promptText + "\n\n";
    inputBox.style.display = "block";
    inputBox.focus();
    return new Promise(resolve => inputResolve = resolve);
  }

  inputBox.addEventListener("keydown", e => {
    if(e.key === "Enter" && inputResolve){
      const val = inputBox.value;
      output.textContent += val + "\n";
      inputBox.value = "";
      inputBox.style.display = "none";
      inputResolve(val);
      inputResolve = null;
    }
  });

  function builtinRead(x){
    if(!Sk.builtinFiles || !Sk.builtinFiles["files"][x]) throw "File not found: '" + x + "'";
    return Sk.builtinFiles["files"][x];
  }

  // Run code
  function runCode(){
    output.textContent = "";
    Sk.configure({ output: outf, read: builtinRead, inputfun: builtinInput, inputfunTakesPrompt: true });
    Sk.misceval.asyncToPromise(() => Sk.importMainWithBody("<stdin>", false, editor.getValue(), true))
      .catch(err => output.textContent += err.toString());
  }
  document.getElementById("runBtn").addEventListener("click", runCode);

  // Auto-save
  editor.on("change", () => localStorage.setItem("willIDE_code", editor.getValue()));

  // Load code from URL or localStorage
  window.onload = () => {
    const params = new URLSearchParams(window.location.search);
    const codeFromURL = params.get("code");
    if(codeFromURL) editor.setValue(decodeURIComponent(codeFromURL));
    else {
      const saved = localStorage.getItem("willIDE_code");
      if(saved) editor.setValue(saved);
    }
    setTimeout(() => editor.refresh(), 0);
  };

  // Download code
  document.getElementById("downloadBtn").addEventListener("click", () => {
    const code = editor.getValue();
    const blob = new Blob([code], {type:"text/plain"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "code.py";
    a.click();
    URL.revokeObjectURL(url);
  });

  // Share code
  document.getElementById("shareBtn").addEventListener("click", () => {
    const url = `${window.location.origin}${window.location.pathname}?code=${encodeURIComponent(editor.getValue())}`;
    navigator.clipboard.writeText(url);
    alert("Share URL copied! Open this code in WIDE.");
  });
</script>

</body>
</html>





