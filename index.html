<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WIDE - Python IDE</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">

<style>
body {
  margin:0;
  padding:20px;
  font-family: monospace;
  background-color:#1e1e1e;
  color:white;
  text-align:center;
}

h1 { font-size:48px; margin-bottom:20px; letter-spacing:2px; }

#toolbar button {
  padding:12px 24px;
  font-size:18px;
  background-color:#6272a4;
  color:white;
  border:1px solid #fff;
  border-radius:5px;
  cursor:pointer;
  margin:5px;
}

#ide-container { display:flex; width:90%; margin:0 auto; height:500px; gap:10px; }
#editor-container, #output-container {
  flex:1;
  display:flex;
  flex-direction:column;
  border:2px solid white;
  box-sizing:border-box;
  height:100%;
}
.CodeMirror { flex:1; height:100%; text-align:left; }
#output { flex:1; background-color:#111; color:#00ff00; padding:10px; white-space:pre-wrap; overflow-y:auto; text-align:left; }
#inputBox { margin-top:5px; width:100%; padding:10px; font-family:monospace; font-size:16px; }

/* Light mode */
body.light { background-color:#f5f5f5; color:#111; }
body.light #editor-container, body.light #output-container { border-color:#111; }
body.light #output { background-color:#fff; color:#000; }
body.light #toolbar button { background-color:#ddd; color:#000; border-color:#000; }

/* Hide IDE until logged in */
#toolbar, #ide-container { display:none; }
#authContainer { margin-top:50px; }
#authContainer button { padding:15px 30px; font-size:20px; margin:10px; }
</style>

<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>
</head>

<body>

<h1>WIDE</h1>

<!-- Sign up / Log in / Guest -->
<div id="authContainer">
  <button id="signUpBtn">Sign Up</button>
  <button id="logInBtn">Log In</button>
  <button id="guestBtn">Continue as Guest</button>
</div>

<!-- Toolbar -->
<div id="toolbar">
  <button id="runBtn">Run Python</button>
  <button id="downloadBtn">Download .py</button>
  <button id="shareBtn">Share this code</button>
  <button id="themeBtn">Light Mode</button>
  <button id="fileBtn">Save File</button>
  <button id="deleteFileBtn">Delete File</button>
  <button id="renameFileBtn">Rename File</button>
  <select id="fileList" style="margin-left:5px; font-size:16px;">
    <option value="">Select file...</option>
  </select>
</div>

<!-- IDE -->
<div id="ide-container">
  <div id="editor-container">
    <textarea id="editor"></textarea>
  </div>
  <div id="output-container">
    <h2>Output</h2>
    <pre id="output"></pre>
    <input id="inputBox" placeholder="Type input and press Enter">
  </div>
</div>

<script>
// --- CodeMirror ---
const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
  mode:"python", theme:"dracula", lineNumbers:true, indentUnit:4, tabSize:4
});

// --- Skulpt setup ---
const output = document.getElementById("output");
const inputBox = document.getElementById("inputBox");
let inputResolve = null;

function outf(text){ output.textContent += text; }
function builtinInput(promptText){ output.textContent+=promptText+"\n"; inputBox.focus(); return new Promise(resolve=>inputResolve=resolve); }
inputBox.addEventListener("keydown", e=>{ 
  if(e.key==="Enter" && inputResolve){ const val=inputBox.value; output.textContent+=val+"\n"; inputBox.value=""; inputResolve(val); inputResolve=null; } 
});
function builtinRead(x){ if(!Sk.builtinFiles||!Sk.builtinFiles["files"][x]) throw "File not found: '"+x+"'"; return Sk.builtinFiles["files"][x]; }

function runCode(){ 
  output.textContent="";
  Sk.configure({output:outf, read:builtinRead, inputfun:builtinInput, inputfunTakesPrompt:true});
  Sk.misceval.asyncToPromise(()=>Sk.importMainWithBody("<stdin>", false, editor.getValue(), true))
    .catch(err=>output.textContent+=err.toString());
}
document.getElementById("runBtn").onclick = runCode;

// --- Auto-save ---
editor.on("change", ()=>localStorage.setItem("willIDE_code", editor.getValue()));

// --- Theme toggle ---
const themeBtn=document.getElementById("themeBtn");
function setTheme(mode){
  if(mode==="light"){ document.body.classList.add("light"); editor.setOption("theme","default"); themeBtn.textContent="Dark Mode"; }
  else{ document.body.classList.remove("light"); editor.setOption("theme","dracula"); themeBtn.textContent="Light Mode"; }
  localStorage.setItem("wide_theme", mode);
}
themeBtn.onclick = ()=>setTheme(document.body.classList.contains("light")?"dark":"light");

// --- Download ---
document.getElementById("downloadBtn").onclick = ()=>{
  const blob = new Blob([editor.getValue()], {type:"text/plain"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download="code.py";
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
};

// --- Share ---
document.getElementById("shareBtn").onclick = ()=>{
  const url = `${location.origin}${location.pathname}?code=${encodeURIComponent(editor.getValue())}`;
  navigator.clipboard.writeText(url); alert("Share URL copied!");
};

// --- Users & auth ---
let users = JSON.parse(localStorage.getItem("wide_users")||"{}");
let currentUser = null;

const authContainer = document.getElementById("authContainer");
const toolbar = document.getElementById("toolbar");

// Show IDE for current user
function showIDE() {
  authContainer.style.display="none";
  toolbar.style.display="flex";
  document.getElementById("ide-container").style.display="flex";

  // Guests cannot see file buttons
  if(currentUser==="Guest"){
    fileBtn.style.display="none"; deleteFileBtn.style.display="none"; renameFileBtn.style.display="none"; fileList.style.display="none";
  } else {
    fileBtn.style.display="inline-block"; deleteFileBtn.style.display="inline-block"; renameFileBtn.style.display="inline-block"; fileList.style.display="inline-block";
    loadFilesForUser();
  }
}

// --- Sign Up ---
document.getElementById("signUpBtn").onclick = ()=>{
  const username = prompt("Enter username:");
  if(!username) return alert("Username required");
  if(users[username]) return alert("Username exists");
  const password = prompt("Enter password:");
  if(!password) return alert("Password required");
  users[username]=password;
  localStorage.setItem("wide_users", JSON.stringify(users));
  alert("Sign up complete! Please log in now.");
};

// --- Log In ---
document.getElementById("logInBtn").onclick = ()=>{
  const username = prompt("Enter username:");
  const password = prompt("Enter password:");
  if(users[username] && users[username]===password){ currentUser=username; showIDE(); alert("Welcome to WIDE, "+username+"!"); }
  else alert("Incorrect username or password");
};

// --- Guest ---
document.getElementById("guestBtn").onclick = ()=>{
  currentUser="Guest"; showIDE();
};

// --- Files ---
let files = {}; // per-user memory
const fileBtn = document.getElementById("fileBtn");
const deleteFileBtn = document.getElementById("deleteFileBtn");
const renameFileBtn = document.getElementById("renameFileBtn");
const fileList = document.getElementById("fileList");

function updateFileList() {
  fileList.innerHTML = '<option value="">Select file...</option>';
  for(const fname in files){
    const option=document.createElement("option");
    option.value=fname; option.textContent=fname;
    fileList.appendChild(option);
  }
  deleteFileBtn.disabled = true;
  renameFileBtn.disabled = true;
}

function saveFilesForUser(){
  if(currentUser && currentUser!=="Guest") localStorage.setItem("wide_files_"+currentUser, JSON.stringify(files));
}

function loadFilesForUser(){
  if(currentUser && currentUser!=="Guest"){
    files = JSON.parse(localStorage.getItem("wide_files_"+currentUser)||"{}");
    updateFileList();
  }
}

// Save
fileBtn.onclick = ()=>{
  const fname = prompt("Enter file name:");
  if(!fname) return;
  files[fname] = editor.getValue();
  saveFilesForUser(); updateFileList();
  alert("Saved as "+fname);
};

// Delete
deleteFileBtn.onclick = ()=>{
  const fname = fileList.value;
  if(!fname) return alert("Select a file to delete");
  if(!confirm("Delete "+fname+"?")) return;
  delete files[fname]; saveFilesForUser(); updateFileList(); editor.setValue(""); alert(fname+" deleted");
};

// Rename
renameFileBtn.onclick = ()=>{
  const fname = fileList.value;
  if(!fname) return alert("Select a file to rename");
  const newName = prompt("Enter new name for "+fname+":");
  if(!newName) return;
  if(files[newName]!==undefined) return alert("File exists");
  files[newName]=files[fname]; delete files[fname]; saveFilesForUser(); updateFileList(); fileList.value=newName;
};

// Enable delete/rename buttons only when a file selected
fileList.onchange = ()=>{
  const fname = fileList.value;
  if(fname && files[fname]!==undefined){ deleteFileBtn.disabled=false; renameFileBtn.disabled=false; editor.setValue(files[fname]); }
  else { deleteFileBtn.disabled=true; renameFileBtn.disabled=true; }
};
</script>

</body>
</html>












