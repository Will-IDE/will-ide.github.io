<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WIDE - Python IDE</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">

<style>
body {
  margin:0;
  padding:20px;
  font-family: monospace;
  background-color:#1e1e1e;
  color:white;
  text-align:center;
}

/* ===== AUTH PANEL ===== */
#authPanel {
  position:fixed;
  top:0; left:0; right:0; bottom:0;
  background:#1e1e1e;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:10;
}

#authBox {
  border:2px solid white;
  padding:30px;
  width:320px;
}

#authBox input {
  width:90%;
  padding:10px;
  margin:8px 0;
  font-family:monospace;
}

#authBox button {
  padding:10px 18px;
  margin:6px;
  font-size:16px;
  cursor:pointer;
}

#authMsg {
  color:#ff5555;
  min-height:18px;
}

/* ===== IDE ===== */

h1 {
  font-size:48px;
  margin-bottom:10px;
}

#toolbar button {
  padding:10px 18px;
  margin:4px;
  font-size:16px;
  background:#6272a4;
  color:white;
  border:1px solid white;
  cursor:pointer;
}

#ide-container {
  display:flex;
  width:90%;
  margin:10px auto;
  height:500px;
  gap:10px;
}

#editor-container, #output-container {
  flex:1;
  border:2px solid white;
  display:flex;
  flex-direction:column;
}

.CodeMirror {
  flex:1;
  height:100%;
  text-align:left;
}

#output {
  flex:1;
  background:#111;
  color:#00ff00;
  padding:10px;
  overflow-y:auto;
  text-align:left;
}

#inputBox {
  padding:10px;
  font-family:monospace;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>
</head>

<body>

<!-- ========== AUTH PANEL ========== -->
<div id="authPanel">
  <div id="authBox">
    <h2 id="authTitle">Welcome to WIDE</h2>

    <!-- Start Buttons -->
    <div id="startButtons">
      <button id="btnSignup">Sign Up</button>
      <button id="btnLogin">Log In</button>
      <button id="btnGuest">Use Without Account</button>
    </div>

    <!-- Form -->
    <div id="authForm" style="display:none;">
      <input id="username" placeholder="Username">
      <input id="password" type="password" placeholder="Password">
      <button id="submitAuth"></button>
      <p id="authMsg"></p>
      <button id="backBtn">Back</button>
    </div>
  </div>
</div>

<!-- ========== IDE ========== -->
<h1>WIDE</h1>

<div id="toolbar">
  <button id="runBtn">Run Python</button>
  <button id="downloadBtn">Download .py</button>
  <button id="fileBtn">Files</button>
  <select id="fileList">
    <option value="">Select file...</option>
  </select>
</div>

<div id="ide-container">
  <div id="editor-container">
    <textarea id="editor"></textarea>
  </div>
  <div id="output-container">
    <pre id="output"></pre>
    <input id="inputBox" placeholder="Type input and press Enter">
  </div>
</div>

<script>
/* ========= AUTH SYSTEM ========= */

const authPanel = document.getElementById("authPanel");
const startButtons = document.getElementById("startButtons");
const authForm = document.getElementById("authForm");
const authTitle = document.getElementById("authTitle");
const authMsg = document.getElementById("authMsg");
const submitAuth = document.getElementById("submitAuth");
const backBtn = document.getElementById("backBtn");

let authMode = "";
let currentUser = null;

function loadUsers(){
  return JSON.parse(localStorage.getItem("wide_users") || "{}");
}
function saveUsers(users){
  localStorage.setItem("wide_users", JSON.stringify(users));
}

// Open signup
btnSignup.onclick = ()=>{
  authMode = "signup";
  startButtons.style.display="none";
  authForm.style.display="block";
  authTitle.textContent="Create Account";
  submitAuth.textContent="Sign Up";
  authMsg.textContent="";
};

// Open login
btnLogin.onclick = ()=>{
  authMode = "login";
  startButtons.style.display="none";
  authForm.style.display="block";
  authTitle.textContent="Log In";
  submitAuth.textContent="Log In";
  authMsg.textContent="";
};

// Back
backBtn.onclick = ()=>{
  authForm.style.display="none";
  startButtons.style.display="block";
  authTitle.textContent="Welcome to WIDE";
};

// Guest
btnGuest.onclick = ()=>{
  authPanel.style.display="none";
  fileBtn.style.display="none";
  fileList.style.display="none";
};

// Submit auth
submitAuth.onclick = ()=>{
  const u = username.value.trim();
  const p = password.value.trim();
  authMsg.textContent="";

  if(!u || !p){
    authMsg.textContent="Enter username and password";
    return;
  }

  const users = loadUsers();

  // SIGN UP
  if(authMode==="signup"){
    if(users[u]){
      authMsg.textContent="Username already exists";
      return;
    }
    users[u] = {password:p, files:{}};
    saveUsers(users);

    // After signup â†’ send to login screen
    authMode="login";
    authTitle.textContent="Account created! Now Log In";
    submitAuth.textContent="Log In";
    authMsg.textContent="";
    username.value="";
    password.value="";
    return;
  }

  // LOG IN
  if(authMode==="login"){
    if(users[u] && users[u].password === p){
      currentUser = u;
      authPanel.style.display="none";
      loadUserFiles();
    } else {
      authMsg.textContent="Incorrect username or password";
    }
  }
};

/* ========= FILE SYSTEM ========= */

const fileBtn = document.getElementById("fileBtn");
const fileList = document.getElementById("fileList");

function loadUserFiles(){
  const users = loadUsers();
  if(!currentUser) return;
  const userFiles = users[currentUser].files;
  fileList.innerHTML='<option value="">Select file...</option>';
  for(const fname in userFiles){
    const opt=document.createElement("option");
    opt.value=fname;
    opt.textContent=fname;
    fileList.appendChild(opt);
  }
}

fileBtn.onclick = ()=>{
  if(!currentUser) return;
  const fname = prompt("File name:");
  if(!fname) return;
  const users = loadUsers();
  users[currentUser].files[fname] = editor.getValue();
  saveUsers(users);
  loadUserFiles();
};

fileList.onchange = ()=>{
  const users = loadUsers();
  const fname = fileList.value;
  if(fname && users[currentUser].files[fname]){
    editor.setValue(users[currentUser].files[fname]);
  }
};

/* ========= PYTHON IDE ========= */

const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
  mode:"python",
  theme:"dracula",
  lineNumbers:true
});

const output = document.getElementById("output");
const inputBox = document.getElementById("inputBox");
let inputResolve=null;

function outf(text){ output.textContent+=text; }

function builtinInput(promptText){
  output.textContent+=promptText+"\n";
  return new Promise(resolve=>inputResolve=resolve);
}

inputBox.addEventListener("keydown", e=>{
  if(e.key==="Enter" && inputResolve){
    const val=inputBox.value;
    output.textContent+=val+"\n";
    inputBox.value="";
    inputResolve(val);
    inputResolve=null;
  }
});

function builtinRead(x){
  if(!Sk.builtinFiles["files"][x]) throw "File not found";
  return Sk.builtinFiles["files"][x];
}

runBtn.onclick = ()=>{
  output.textContent="";
  Sk.configure({output:outf, read:builtinRead, inputfun:builtinInput, inputfunTakesPrompt:true});
  Sk.misceval.asyncToPromise(()=>Sk.importMainWithBody("<stdin>", false, editor.getValue(), true))
  .catch(err=>output.textContent+=err.toString());
};

downloadBtn.onclick = ()=>{
  const blob = new Blob([editor.getValue()],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="code.py";
  a.click();
};
</script>

</body>
</html>















