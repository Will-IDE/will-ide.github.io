<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WIDE - Browser Python IDE</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">

<style>
:root{
  --bg:#1e1e1e;
  --fg:#ffffff;
  --panel:#252526;
  --accent:#00bcd4;
  --border:#333;
  --output:#111;
}

body.light{
  --bg:#f5f5f5;
  --fg:#111;
  --panel:#ffffff;
  --accent:#007acc;
  --border:#ccc;
  --output:#ffffff;
}

body{
  margin:0;
  font-family:monospace;
  background:var(--bg);
  color:var(--fg);
  text-align:center;
}

/* ===== Header ===== */
#topbar{
  background:var(--panel);
  padding:12px;
  font-size:26px;
  letter-spacing:3px;
  border-bottom:2px solid var(--accent);
  box-shadow:0 2px 8px rgba(0,0,0,0.4);
}

/* ===== Toolbar ===== */
#toolbar{
  background:var(--panel);
  padding:10px;
  margin:15px auto;
  border-radius:8px;
  display:inline-block;
  box-shadow:0 4px 10px rgba(0,0,0,0.4);
}

#toolbar button, #toolbar select{
  background:transparent;
  color:var(--fg);
  border:1px solid var(--border);
  padding:8px 14px;
  margin:4px;
  font-size:15px;
  border-radius:6px;
  cursor:pointer;
  transition:0.2s;
}

#toolbar button:hover{
  border-color:var(--accent);
  color:var(--accent);
}

/* ===== IDE ===== */
#ide-container{
  width:92%;
  margin:auto;
  height:520px;
  display:flex;
  gap:12px;
}

#editor-container,#output-container{
  flex:1;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:8px;
  display:flex;
  flex-direction:column;
  box-shadow:0 4px 12px rgba(0,0,0,0.4);
  overflow:hidden;
}

.CodeMirror{
  flex:1;
  height:100%;
  text-align:left;
}

#output{
  flex:1;
  background:var(--output);
  padding:10px;
  overflow-y:auto;
  text-align:left;
  color:#00ff88;
}

body.light #output{ color:#000; }

#inputBox{
  border:none;
  border-top:1px solid var(--border);
  padding:10px;
  font-family:monospace;
  outline:none;
  background:var(--panel);
  color:var(--fg);
}

/* ===== Welcome Animation ===== */
#welcomeFlash{
  position:fixed;
  inset:0;
  background:var(--bg);
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:32px;
  letter-spacing:3px;
  z-index:20;
  opacity:0;
  pointer-events:none;
  transition:opacity 1s;
}

/* ===== Auth Panel ===== */
#authPanel{
  position:fixed;
  inset:0;
  background:var(--bg);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:30;
}

#authBox{
  background:var(--panel);
  padding:30px;
  border:2px solid var(--border);
  border-radius:10px;
  width:320px;
}

#authBox input{
  width:90%;
  padding:10px;
  margin:8px 0;
  font-family:monospace;
}

#authBox button{
  padding:10px 16px;
  margin:5px;
  cursor:pointer;
}

#authMsg{ color:#ff5555; min-height:18px; }

/* ===== Responsive ===== */
@media(max-width:900px){
  #ide-container{ flex-direction:column; height:auto; }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>
</head>

<body>

<div id="welcomeFlash">Welcome to WIDE</div>

<!-- ===== Auth Panel ===== -->
<div id="authPanel">
  <div id="authBox">
    <h2 id="authTitle">Welcome to WIDE</h2>

    <div id="startButtons">
      <button id="btnSignup">Sign Up</button>
      <button id="btnLogin">Log In</button>
      <button id="btnGuest">Use as Guest</button>
    </div>

    <div id="authForm" style="display:none;">
      <input id="username" placeholder="Username">
      <input id="password" type="password" placeholder="Password">
      <button id="submitAuth"></button>
      <p id="authMsg"></p>
      <button id="backBtn">Back</button>
    </div>
  </div>
</div>

<div id="topbar">WIDE â€” Browser Python IDE</div>

<div id="toolbar">
  <button id="runBtn">â–¶ Run</button>
  <button id="downloadBtn">ðŸ’¾ Download</button>
  <button id="shareBtn">ðŸ”— Share</button>
  <button id="fileBtn">ðŸ“‚ Files</button>
  <select id="fileList">
    <option value="">Select file...</option>
  </select>
  <button id="themeBtn">Light Mode</button>
</div>

<div id="ide-container">
  <div id="editor-container">
    <textarea id="editor"></textarea>
  </div>
  <div id="output-container">
    <pre id="output"></pre>
    <input id="inputBox" placeholder="Type input and press Enter">
  </div>
</div>

<script>
/* ===== CodeMirror ===== */
const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
  mode:"python",
  theme:"dracula",
  lineNumbers:true
});

/* ===== Theme ===== */
const themeBtn = document.getElementById("themeBtn");
function setTheme(mode){
  if(mode==="light"){
    document.body.classList.add("light");
    editor.setOption("theme","default");
    themeBtn.textContent="Dark Mode";
  }else{
    document.body.classList.remove("light");
    editor.setOption("theme","dracula");
    themeBtn.textContent="Light Mode";
  }
  localStorage.setItem("wide_theme",mode);
}
themeBtn.onclick=()=>{
  const isLight=document.body.classList.contains("light");
  setTheme(isLight?"dark":"light");
};

/* ===== Auth System ===== */
const authPanel=document.getElementById("authPanel");
const startButtons=document.getElementById("startButtons");
const authForm=document.getElementById("authForm");
const authTitle=document.getElementById("authTitle");
const authMsg=document.getElementById("authMsg");
const submitAuth=document.getElementById("submitAuth");
const backBtn=document.getElementById("backBtn");

let authMode="";
let currentUser=null;

function loadUsers(){ return JSON.parse(localStorage.getItem("wide_users")||"{}"); }
function saveUsers(u){ localStorage.setItem("wide_users",JSON.stringify(u)); }

btnSignup.onclick=()=>{
  authMode="signup";
  startButtons.style.display="none";
  authForm.style.display="block";
  authTitle.textContent="Create Account";
  submitAuth.textContent="Sign Up";
};

btnLogin.onclick=()=>{
  authMode="login";
  startButtons.style.display="none";
  authForm.style.display="block";
  authTitle.textContent="Log In";
  submitAuth.textContent="Log In";
};

backBtn.onclick=()=>{
  authForm.style.display="none";
  startButtons.style.display="block";
  authTitle.textContent="Welcome to WIDE";
  authMsg.textContent="";
};

btnGuest.onclick=()=>{
  authPanel.style.display="none";
  fileBtn.style.display="none";
  fileList.style.display="none";
};

submitAuth.onclick=()=>{
  const u=username.value.trim();
  const p=password.value.trim();
  authMsg.textContent="";
  if(!u||!p){ authMsg.textContent="Enter username and password"; return; }
  const users=loadUsers();

  if(authMode==="signup"){
    if(users[u]){ authMsg.textContent="Username already exists"; return; }
    users[u]={password:p,files:{}};
    saveUsers(users);
    authTitle.textContent="Account created! Now Log In";
    authMode="login";
    submitAuth.textContent="Log In";
    username.value=""; password.value="";
    return;
  }

  if(authMode==="login"){
    if(users[u] && users[u].password===p){
      currentUser=u;
      authPanel.style.display="none";
      loadUserFiles();

      const wf=document.getElementById("welcomeFlash");
      wf.style.opacity="1";
      setTimeout(()=>wf.style.opacity="0",1200);
    } else authMsg.textContent="Incorrect details";
  }
};

/* ===== File System ===== */
const fileBtn=document.getElementById("fileBtn");
const fileList=document.getElementById("fileList");

function loadUserFiles(){
  const users=loadUsers();
  const files=users[currentUser].files;
  fileList.innerHTML='<option value="">Select file...</option>';
  for(const f in files){
    const o=document.createElement("option");
    o.value=f; o.textContent=f;
    fileList.appendChild(o);
  }
}

fileBtn.onclick=()=>{
  if(!currentUser) return;
  const fname=prompt("File name:");
  if(!fname) return;
  const users=loadUsers();
  users[currentUser].files[fname]=editor.getValue();
  saveUsers(users);
  loadUserFiles();
};

fileList.onchange=()=>{
  const users=loadUsers();
  const fname=fileList.value;
  if(fname) editor.setValue(users[currentUser].files[fname]);
};

/* ===== Python Runner ===== */
const output=document.getElementById("output");
const inputBox=document.getElementById("inputBox");
let inputResolve=null;

function outf(t){ output.textContent+=t; }
function builtinInput(p){ output.textContent+=p+"\n"; return new Promise(r=>inputResolve=r); }

inputBox.addEventListener("keydown",e=>{
  if(e.key==="Enter"&&inputResolve){
    const v=inputBox.value;
    output.textContent+=v+"\n";
    inputBox.value="";
    inputResolve(v);
    inputResolve=null;
  }
});

function builtinRead(x){
  if(!Sk.builtinFiles["files"][x]) throw "File not found";
  return Sk.builtinFiles["files"][x];
}

runBtn.onclick=()=>{
  output.textContent="";
  Sk.configure({output:outf,read:builtinRead,inputfun:builtinInput,inputfunTakesPrompt:true});
  Sk.misceval.asyncToPromise(()=>Sk.importMainWithBody("<stdin>",false,editor.getValue(),true))
  .catch(e=>output.textContent+=e.toString());
};

/* ===== Download ===== */
downloadBtn.onclick=()=>{
  const blob=new Blob([editor.getValue()],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="code.py";
  a.click();
};

/* ===== Share ===== */
shareBtn.onclick=()=>{
  const url=`${location.origin}${location.pathname}?code=${encodeURIComponent(editor.getValue())}`;
  navigator.clipboard.writeText(url);
  alert("Share link copied!");
};

/* ===== Load Saved Theme ===== */
window.onload=()=>{
  setTheme(localStorage.getItem("wide_theme")||"dark");
};
</script>

</body>
</html>












